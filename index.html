<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AuditorIA 360</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: GMC360 2025 -->
    <!-- Application Structure Plan: Se ha dise√±ado una SPA con una estructura de tres pesta√±as tem√°ticas para separar claramente los casos de uso: 1) Gu√≠a Estrat√©gica (consulta de informaci√≥n), 2) Asistente de Hallazgos (herramienta de trabajo para auditores) y 3) Simulador de Examen (herramienta de estudio). Esta arquitectura modular permite al usuario enfocarse en una tarea a la vez, mejorando la usabilidad. La navegaci√≥n es simple y directa, facilitando el acceso a cada herramienta sin salir de la p√°gina. -->
    <!-- Visualization & Content Choices: La "Gu√≠a Estrat√©gica" utiliza texto estructurado con HTML y Tailwind para presentar el an√°lisis ejecutivo. El objetivo es INFORMAR. Los m√≥dulos interactivos usar√°n men√∫s desplegables (select) para la selecci√≥n y mostrar√°n los resultados generados por la IA en bloques de texto din√°micos. El objetivo es ORGANIZAR la auditor√≠a y PROBAR el conocimiento. Las visualizaciones se basan en texto din√°mico generado por la IA, evitando gr√°ficos complejos para mantener la claridad. Las interacciones se manejan con JavaScript y llamadas a una API externa (funci√≥n Netlify). -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body { font-family: 'Inter', sans-serif; }
        .bg-custom-purple { background-color: #8a62c4; }
        .bg-custom-offwhite { background-color: #f6fff8; }
        .text-custom-purple { color: #8a62c4; }
        .text-custom-gray { color: #4d4d4d; }
        .text-custom-dark-gray { color: #343a40; }
        .hover\:bg-custom-purple-dark:hover { background-color: #734eae; }
        .focus\:ring-custom-purple:focus { --tw-ring-color: rgba(138, 98, 196, 1); }
        .module-btn.active { background-color: #ff8361; color: #ffffff; font-weight: 600; }
        .module-btn { background-color: #e9ecef; color: #495057; }
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .spinner { border: 4px solid rgba(0, 0, 0, 0.1); width: 36px; height: 36px; border-radius: 50%; border-left-color: #8a62c4; animation: spin 1s ease infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-custom-offwhite p-4 md:p-8">

    <header class="text-center mb-8">
        <h1 class="text-3xl md:text-4xl font-bold text-custom-purple">AuditorIA 360</h1>
        <p class="mt-2 text-lg text-custom-gray">Asistente Interactivo para Auditores de PLD/FT</p>
    </header>

    <main class="max-w-4xl mx-auto">
        <div class="flex flex-col sm:flex-row justify-center gap-2 mb-8 p-1 bg-gray-200 rounded-full">
            <button id="btn-guia" class="module-btn w-full text-center py-2 px-4 rounded-full transition-all duration-300">üó∫Ô∏è Gu√≠a Estrat√©gica</button>
            <button id="btn-asistente" class="module-btn w-full text-center py-2 px-4 rounded-full transition-all duration-300">üîç Asistente de Hallazgos</button>
            <button id="btn-simulador" class="module-btn w-full text-center py-2 px-4 rounded-full transition-all duration-300">üìù Simulador de Examen</button>
        </div>

        <div id="module-guia" class="module-content fade-in">
             <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-semibold mb-6 text-custom-dark-gray border-b pb-4">Gu√≠a Estrat√©gica de los Lineamientos de Auditor√≠a</h2>
                <div class="space-y-8 text-custom-gray">
                    <section>
                        <h3 class="font-bold text-xl text-gray-800 mb-2">Apartado A: Preliminares</h3>
                        <p>Establece el objetivo y alcance de los lineamientos, que es normar la <strong>contrataci√≥n</strong> del auditor, la <strong>elaboraci√≥n</strong> del informe y su <strong>remisi√≥n</strong> a la CNBV.</p>
                    </section>
                    <section>
                        <h3 class="font-bold text-xl text-gray-800 mb-2">Apartado B: El Auditor</h3>
                        <p>Define el perfil profesional y √©tico del auditor para garantizar su capacidad e independencia.</p>
                        <div class="mt-4 p-4 border-l-4 border-custom-purple bg-purple-50 rounded-r-lg">
                            <h4 class="font-semibold text-lg text-custom-purple mb-2">Requisitos Clave (100% Detallado):</h4>
                             <ul class="list-disc list-inside space-y-2">
                                <li><strong>Certificado Vigente:</strong> Obligatorio contar con la certificaci√≥n de la CNBV en PLD/FT.</li>
                                <li><strong>Experiencia:</strong> M√≠nimo 3 a√±os con licenciatura, o 5 a√±os sin ella.</li>
                                <li><strong>Sin Sentencias:</strong> No haber sido sentenciado por delitos patrimoniales.</li>
                                <li><strong>Sin Inhabilitaciones:</strong> No estar inhabilitado para ejercer en el servicio p√∫blico o sistema financiero.</li>
                                <li><strong>Independencia Total:</strong> No ser (ni tener oferta) de ser consejero o directivo, ni accionista, OC, funcionario o empleado de la entidad auditada (no aplica para auditores internos).</li>
                                <li><strong>Sin Litigios:</strong> No tener litigios pendientes con la entidad.</li>
                                <li><strong>Sin Suspensiones Previas:</strong> No tener registros suspendidos, cancelados o revocados.</li>
                                <li><strong>Fuera de Listas Negras:</strong> No encontrarse en listas de personas vinculadas a actividades il√≠citas.</li>
                             </ul>
                        </div>
                    </section>
                    <section>
                        <h3 class="font-bold text-xl text-gray-800 mb-2">Apartado C: La Elaboraci√≥n del Informe</h3>
                        <p>Describe el proceso metodol√≥gico de la auditor√≠a, desde la preparaci√≥n hasta las conclusiones.</p>
                        <div class="mt-4 p-4 border-l-4 border-yellow-500 bg-yellow-50 rounded-r-lg">
                            <h4 class="font-semibold text-lg text-yellow-700 mb-2">Los 5 Niveles de Cumplimiento (100% Detallado):</h4>
                            <p class="mb-2">Toda obligaci√≥n se debe calificar con uno de los siguientes niveles:</p>
                            <ul class="list-disc list-inside space-y-1">
                                <li><strong>Cumple:</strong> Se demuestra la eficacia total, no se requieren mejoras.</li>
                                <li><strong>Cumple Mayoritariamente:</strong> La eficacia no es completa. Se debe incluir al menos una recomendaci√≥n de mejora.</li>
                                <li><strong>Cumple Parcialmente:</strong> No hay evidencia objetiva suficiente. Se debe incluir al menos un hallazgo.</li>
                                <li><strong>No Cumple:</strong> El proceso falta, es incorrecto o actualiza una posible sanci√≥n.</li>
                                <li><strong>No Aplica:</strong> La obligaci√≥n no es exigible para la entidad por sus caracter√≠sticas.</li>
                            </ul>
                        </div>
                    </section>
                    <section>
                        <h3 class="font-bold text-xl text-gray-800 mb-2">Apartado D: El Informe Final</h3>
                         <p>Regula la presentaci√≥n, entrega y resguardo del documento final, asegurando su formalidad y validez. El informe debe ser remitido a la CNBV a trav√©s del portal SITI PLD/FT.</p>
                    </section>
                </div>
            </div>
        </div>

        <div id="module-asistente" class="module-content hidden fade-in">
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-semibold mb-4 text-custom-dark-gray">1. Seleccione la Obligaci√≥n a Revisar</h2>
                <select id="obligation-select" class="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-custom-purple transition"></select>
                <div id="selected-obligation-text" class="mt-4 p-4 bg-gray-100 rounded-md text-gray-700 min-h-[50px]">Seleccione una obligaci√≥n del men√∫ para ver su descripci√≥n.</div>
                <button id="generate-guide-btn" class="mt-6 w-full bg-custom-purple text-white font-bold py-3 px-6 rounded-lg shadow-lg hover:bg-custom-purple-dark transition-all duration-300 flex items-center justify-center text-lg disabled:opacity-50" disabled>‚ú® Generar Gu√≠a de Auditor√≠a con IA</button>
                <div id="loader-asistente" class="hidden mt-6 flex flex-col items-center justify-center text-center"><div class="spinner"></div><p class="text-custom-gray mt-2">Analizando... La IA est√° preparando su gu√≠a de auditor√≠a.</p></div>
                <div id="asistente-result" class="mt-6"></div>
            </div>
        </div>

        <div id="module-simulador" class="module-content hidden fade-in">
             <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-semibold mb-4 text-custom-dark-gray">1. Seleccione un Tema para Practicar</h2>
                 <select id="topic-select" class="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-custom-purple transition"></select>
                <button id="generate-question-btn" class="mt-6 w-full bg-custom-purple text-white font-bold py-3 px-6 rounded-lg shadow-lg hover:bg-custom-purple-dark transition-all duration-300 flex items-center justify-center text-lg disabled:opacity-50" disabled>üß† Generar Pregunta de Caso Pr√°ctico</button>
                <div id="loader-simulador" class="hidden mt-6 flex flex-col items-center justify-center text-center"><div class="spinner"></div><p class="text-custom-gray mt-2">Creando un nuevo caso de estudio...</p></div>
                <div id="simulador-result" class="mt-6"></div>
            </div>
        </div>
    </main>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const obligationsData = [
                {id: 3,categoria: "1. IDENTIFICACI√ìN",obligacion: "I.a) Cuenta con un Manual de Cumplimiento con criterios para la debida Identificaci√≥n del Cliente/Usuario."},
                {id: 7,categoria: "1. IDENTIFICACI√ìN",obligacion: "I.b) Identifica al Cliente/Usuario conforme al perfil, caracter√≠sticas y requisitos de las Disposiciones."},
                {id: 12,categoria: "1. IDENTIFICACI√ìN",obligacion: "I.c) Aplica pol√≠ticas de identificaci√≥n en Cuentas Concentradoras."},
                {id: 13,categoria: "1. IDENTIFICACI√ìN",obligacion: "I.d) Cuenta con mecanismos de seguimiento, agrupaci√≥n y escalamiento de aprobaci√≥n interna."},
                {id: 14,categoria: "1. IDENTIFICACI√ìN",obligacion: "I.e) Cuenta con pol√≠ticas para verificar expedientes y reclasificar por Grado de Riesgo."},
                {id: 16,categoria: "1. IDENTIFICACI√ìN",obligacion: "I.f) Ha realizado visitas al domicilio del Cliente/Usuario de conformidad con las Disposiciones."},
                {id: 18,categoria: "2. METODOLOG√çA",obligacion: "II.a) Estableci√≥ procesos para la identificaci√≥n, medici√≥n y mitigaci√≥n de Riesgos."},
                {id: 19,categoria: "2. METODOLOG√çA",obligacion: "II.b) Dise√±√≥ e implement√≥ una metodolog√≠a para la evaluaci√≥n de Riesgos."},
                {id: 20,categoria: "2. METODOLOG√çA",obligacion: "II.c) Consider√≥ el total de productos, servicios, clientes, etc., en la identificaci√≥n de indicadores de Riesgo."},
                {id: 21,categoria: "2. METODOLOG√çA",obligacion: "II.d) Utiliz√≥ un m√©todo para la medici√≥n de Riesgos y asign√≥ pesos de manera consistente."},
                {id: 22,categoria: "2. METODOLOG√çA",obligacion: "II.e) Identific√≥ Mitigantes y su efectiva aplicaci√≥n."},
                {id: 23,categoria: "2. METODOLOG√çA",obligacion: "II.f) Modific√≥ pol√≠ticas y procedimientos en funci√≥n de los Riesgos identificados."},
                {id: 25,categoria: "2. METODOLOG√çA",obligacion: "II.g) Puso en funcionamiento la metodolog√≠a sin inconsistencias y con informaci√≥n de al menos 12 meses."},
                {id: 26,categoria: "2. METODOLOG√çA",obligacion: "II.h) Realiz√≥ la valoraci√≥n de la Metodolog√≠a, revisando su eficiencia y eficacia."},
                {id: 28,categoria: "3. CONOCIMIENTO",obligacion: "III.a) Cuenta con Manual que contenga criterios para el debido conocimiento del Cliente/Usuario."},
                {id: 29,categoria: "3. CONOCIMIENTO",obligacion: "III.b) Cuenta con criterios para determinar el perfil y comportamiento transaccional del Cliente/Usuario."},
                {id: 30,categoria: "3. CONOCIMIENTO",obligacion: "III.c) Cuenta con un modelo de evaluaci√≥n de Riesgos para determinar el Grado de Riesgo de los Clientes."},
                {id: 32,categoria: "3. CONOCimiento",obligacion: "III.d) Cuenta con un sistema de alertas para detectar cambios en el comportamiento transaccional."},
                {id: 33,categoria: "3. CONOCIMIENTO",obligacion: "III.e) Cuenta con criterios para la supervisi√≥n del comportamiento transaccional de Clientes de alto Riesgo."},
                {id: 34,categoria: "3. CONOCIMIENTO",obligacion: "III.f) Cuenta con criterios relacionados con Personas Pol√≠ticamente Expuestas (PEPs)."},
                {id: 35,categoria: "3. CONOCIMIENTO",obligacion: "III.g) Ha realizado Operaciones con PEPs de alto Riesgo, aprobadas de conformidad con las Disposiciones."},
                {id: 36,categoria: "3. CONOCIMIENTO",obligacion: "III.h) Ha realizado Operaciones de alto Riesgo, aprobadas de conformidad con las Disposiciones."},
                {id: 37,categoria: "3. CONOCIMIENTO",obligacion: "III.i) Cuenta con pol√≠ticas para identificar al Propietario Real."},
                {id: 38,categoria: "3. CONOCIMIENTO",obligacion: "III.j) Cuenta con criterios para identificar operaciones con otros Sujetos Supervisados."},
                {id: 42,categoria: "3. CONOCIMIENTO",obligacion: "III.k) Cuenta con pol√≠ticas para identificar a Clientes/Usuarios en la Lista de Personas Bloqueadas."},
                {id: 44,categoria: "4. REPORTES",obligacion: "IV.a) Present√≥ en tiempo y forma los reportes de Operaciones Relevantes."},
                {id: 45,categoria: "4. REPORTES",obligacion: "IV.b) Present√≥ en tiempo y forma los reportes de Operaciones Inusuales."},
                {id: 47,categoria: "4. REPORTES",obligacion: "IV.c) Present√≥ en tiempo y forma los Reportes de 24 horas."},
                {id: 48,categoria: "4. REPORTES",obligacion: "IV.d) Present√≥ en tiempo y forma los reportes de Operaciones Internas Preocupantes."},
                {id: 50,categoria: "4. REPORTES",obligacion: "IV.e) Present√≥ en tiempo y forma los dem√°s reportes (transferencias, d√≥lares en efectivo, etc.)."},
                {id: 52,categoria: "4. REPORTES",obligacion: "El auditor debe se√±alar operaciones omitidas, fuera de plazo o que contravengan las Disposiciones."},
                {id: 54,categoria: "5. ESTRUCTURAS INTERNAS",obligacion: "V.a) Integr√≥ el Comit√© de Comunicaci√≥n y Control (CCC) de conformidad con las Disposiciones."},
                {id: 55,categoria: "5. ESTRUCTURAS INTERNAS",obligacion: "V.b) Comunic√≥ la integraci√≥n inicial y cambios de su CCC a la autoridad."},
                {id: 58,categoria: "5. ESTRUCTURAS INTERNAS",obligacion: "V.d) Realiz√≥ la designaci√≥n o revocaci√≥n del Oficial de Cumplimiento (OC)."},
                {id: 59,categoria: "5. ESTRUCTURAS INTERNAS",obligacion: "V.e) Comunic√≥ la designaci√≥n o revocaci√≥n de su OC a la autoridad."},
                {id: 64,categoria: "6. CAPACITACI√ìN Y DIFUSI√ìN",obligacion: "VI.a) Cuenta con un programa anual de capacitaci√≥n coherente con la Metodolog√≠a de Riesgos."},
                {id: 65,categoria: "6. CAPACITACI√ìN Y DIFUSI√ìN",obligacion: "VI.b) Imparti√≥ cursos de capacitaci√≥n a todo el personal relevante."},
                {id: 66,categoria: "6. CAPACITACI√ìN Y DIFUSI√ìN",obligacion: "VI.c) Difundi√≥ las Disposiciones, sus modificaciones y tendencias en PLD/FT."},
                {id: 67,categoria: "6. CAPACITACI√ìN Y DIFUSI√ìN",obligacion: "VI.d) Expidi√≥ constancias que acreditan la participaci√≥n en los cursos."},
                {id: 68,categoria: "6. CAPACITACI√ìN Y DIFUSI√ìN",obligacion: "VI.e) Cuenta con medidas para el caso de calificaciones no satisfactorias."},
                {id: 69,categoria: "7. INFRAESTRUCTURA TECNOL√ìGICA",obligacion: "VII. Cuenta con sistemas automatizados que desarrollen todas las funciones de las Disposiciones."},
                {id: 71,categoria: "8. EMPLEADOS",obligacion: "VIII.a) Cuenta con procedimientos de selecci√≥n de empleados."},
                {id: 72,categoria: "8. EMPLEADOS",obligacion: "VIII.b) Cuenta con expedientes de cada uno de los empleados."},
                {id: 73,categoria: "8. EMPLEADOS",obligacion: "VIII.c) Cuenta con constancias de capacitaci√≥n previa o simult√°nea al ingreso."},
                {id: 75,categoria: "9. CONSERVACI√ìN",obligacion: "IX.a) Cuenta con mecanismos para conservar por 10 a√±os reportes y expedientes."},
                {id: 76,categoria: "9. CONSERVACI√ìN",obligacion: "IX.b) Conserva por 10 a√±os los reportes y expedientes."},
                {id: 78,categoria: "9. CONSERVACI√ìN",obligacion: "IX.c) Cuenta con mecanismos para conservar por 5 a√±os los informes de auditor√≠a."},
                {id: 82,categoria: "10. LISTAS",obligacion: "X.a) Cuenta con listas oficiales de personas vinculadas a PLD/FT."},
                {id: 85,categoria: "10. LISTAS",obligacion: "X.b) Cuenta con la lista de Personas Pol√≠ticamente Expuestas."},
                {id: 86,categoria: "10. LISTAS",obligacion: "X.c) Cuenta con listas de pa√≠ses con reg√≠menes fiscales preferentes."},
                {id: 87,categoria: "10. LISTAS",obligacion: "X.d) Cuenta con listas de pa√≠ses con medidas deficientes en PLD/FT."},
                {id: 89,categoria: "10. LISTAS",obligacion: "X.e) Cuenta con la Lista de Personas Bloqueadas."},
                {id: 90,categoria: "10. LISTAS",obligacion: "X.f) Ha implementado las medidas establecidas en caso de identificar a un cliente en dichas listas."},
                {id: 92,categoria: "11. INTERCAMBIO DE INFORMACI√ìN",obligacion: "XI.a) Intercambi√≥ informaci√≥n conforme a la forma y t√©rminos de las Disposiciones."},
                {id: 94,categoria: "12. MODELOS NOVEDOSOS",obligacion: "XII.a) Obtuvo la autorizaci√≥n de la CNBV para operar con Modelos Novedosos."},
                {id: 101,categoria: "13. OTRA INFORMACI√ìN",obligacion: "XIII.a) Comunic√≥ en tiempo y forma la informaci√≥n sobre la persona o grupo que ejerce el Control."},
                {id: 102,categoria: "13. OTRA INFORMACI√ìN",obligacion: "XIII.b) Comunic√≥ en tiempo y forma la transmisi√≥n de acciones por m√°s del 2%."},
                {id: 107,categoria: "13. OTRA INFORMACI√ìN",obligacion: "XIII.e) Subsan√≥ las observaciones, recomendaciones y acciones correctivas de la CNBV."},
                {id: 109,categoria: "14. COMISIONISTAS",obligacion: "XIV.a) Realiza la revisi√≥n de las obligaciones relacionadas con comisionistas."},
            ];
            
            const buttons = [ document.getElementById('btn-guia'), document.getElementById('btn-asistente'), document.getElementById('btn-simulador') ];
            const modules = [ document.getElementById('module-guia'), document.getElementById('module-asistente'), document.getElementById('module-simulador') ];
            const loaders = { asistente: document.getElementById('loader-asistente'), simulador: document.getElementById('loader-simulador') };
            const results = { asistente: document.getElementById('asistente-result'), simulador: document.getElementById('simulador-result') };
            const obligationSelect = document.getElementById('obligation-select');
            const topicSelect = document.getElementById('topic-select');
            const selectedObligationText = document.getElementById('selected-obligation-text');
            const generateGuideBtn = document.getElementById('generate-guide-btn');
            const generateQuestionBtn = document.getElementById('generate-question-btn');

            function setupTabs() {
                buttons[0].classList.add('active');
                modules[0].classList.remove('hidden');
                modules[1].classList.add('hidden');
                modules[2].classList.add('hidden');
                buttons.forEach((button, index) => {
                    button.addEventListener('click', () => {
                        buttons.forEach(btn => btn.classList.remove('active'));
                        button.classList.add('active');
                        modules.forEach(module => module.classList.add('hidden'));
                        modules[index].classList.remove('hidden');
                    });
                });
            }

            function populateSelects() {
                const categories = [...new Set(obligationsData.map(item => item.categoria))];
                obligationSelect.innerHTML = '<option value="" disabled selected>-- Elija una obligaci√≥n --</option>';
                categories.forEach(category => {
                    const optgroup = document.createElement('optgroup');
                    optgroup.label = category;
                    obligationsData.filter(item => item.categoria === category).forEach(item => {
                        const option = document.createElement('option');
                        option.value = item.id;
                        option.textContent = item.obligacion.substring(0, 80) + '...';
                        optgroup.appendChild(option);
                    });
                    obligationSelect.appendChild(optgroup);
                });
                topicSelect.innerHTML = '<option value="" disabled selected>-- Elija un tema --</option>';
                categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    topicSelect.appendChild(option);
                });
            }
            
            async function handleApiCall(module, payload) {
                const btn = module === 'asistente' ? generateGuideBtn : generateQuestionBtn;
                loaders[module].classList.remove('hidden');
                results[module].innerHTML = '';
                btn.disabled = true;

                try {
                    const response = await fetch('/.netlify/functions/geminiProxy', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    if (!response.ok) {
                        const errorText = await response.text();
                        throw new Error(`Error de la API: ${response.status} - ${errorText}`);
                    }
                    const result = await response.json();
                    if (!result.candidates || !result.candidates[0].content.parts[0].text) {
                       throw new Error("La respuesta de la API no tiene el formato esperado.");
                    }
                    const jsonText = result.candidates[0].content.parts[0].text;
                    const data = JSON.parse(jsonText);
                    if (module === 'asistente') renderAsistenteResult(data);
                    if (module === 'simulador') renderSimuladorResult(data);
                } catch (error) {
                    console.error("Error:", error);
                    results[module].innerHTML = `<p class="text-red-600 p-4 bg-red-100 rounded-md">Ocurri√≥ un error al contactar a la IA. Revisa la consola para m√°s detalles. (Nota: esta funci√≥n requiere despliegue en Netlify para operar).</p>`;
                } finally {
                    loaders[module].classList.add('hidden');
                    btn.disabled = false;
                }
            }
            
            function renderAsistenteResult(data) {
                const { pruebas_sugeridas = [], posibles_hallazgos = [], recomendaciones_mejora = [] } = data;
                results.asistente.innerHTML = `<div class="border border-gray-200 rounded-lg p-4 fade-in space-y-4"><div><h3 class="text-lg font-semibold mb-2 text-custom-purple">‚ñ∂Ô∏è Pruebas de Auditor√≠a Sugeridas</h3><ul class="list-disc list-inside space-y-1 text-custom-gray">${pruebas_sugeridas.map(item => `<li>${item}</li>`).join('')}</ul></div><div><h3 class="text-lg font-semibold mb-2 text-custom-purple">‚ö†Ô∏è Posibles Hallazgos</h3><ul class="list-disc list-inside space-y-1 text-custom-gray">${posibles_hallazgos.map(item => `<li>${item}</li>`).join('')}</ul></div><div><h3 class="text-lg font-semibold mb-2 text-custom-purple">üí° Recomendaciones de Mejora</h3><ul class="list-disc list-inside space-y-1 text-custom-gray">${recomendaciones_mejora.map(item => `<li>${item}</li>`).join('')}</ul></div></div>`;
            }

            function renderSimuladorResult(data) {
                const { caso_practico, pregunta, opciones, respuesta_correcta, justificacion } = data;
                let optionsHtml = Object.keys(opciones).map(key => `<label class="flex items-center p-3 border rounded-lg hover:bg-gray-50 cursor-pointer"><input type="radio" name="quiz-option" value="${key}" class="form-radio text-purple-600"><span class="ml-3 text-gray-700"><strong>${key})</strong> ${opciones[key]}</span></label>`).join('');
                results.simulador.innerHTML = `<div class="border border-gray-200 rounded-lg p-4 fade-in"><h3 class="text-lg font-semibold mb-2 text-gray-800">Caso Pr√°ctico:</h3><p class="text-custom-gray mb-4">${caso_practico}</p><p class="text-custom-gray font-semibold mb-4">${pregunta}</p><div id="quiz-options" class="space-y-3">${optionsHtml}</div><button id="eval-btn" class="mt-4 bg-gray-700 text-white font-bold py-2 px-5 rounded-lg hover:bg-gray-800">Evaluar Respuesta</button><div id="feedback" class="mt-4 p-3 rounded-r-lg hidden"></div></div>`;
                document.getElementById('eval-btn').addEventListener('click', () => {
                    const selectedOption = document.querySelector('input[name="quiz-option"]:checked');
                    const feedbackDiv = document.getElementById('feedback');
                    if (selectedOption) {
                        feedbackDiv.classList.remove('hidden');
                        if(selectedOption.value === respuesta_correcta) {
                            feedbackDiv.className = 'mt-4 p-3 bg-green-100 text-green-800 border-l-4 border-green-500 rounded-r-lg fade-in';
                            feedbackDiv.innerHTML = `<h4 class="font-bold">¬°Correcto!</h4><p>${justificacion}</p>`;
                        } else {
                            feedbackDiv.className = 'mt-4 p-3 bg-red-100 text-red-800 border-l-4 border-red-500 rounded-r-lg fade-in';
                            feedbackDiv.innerHTML = `<h4 class="font-bold">Incorrecto.</h4><p>La respuesta correcta es la <strong>${respuesta_correcta}</strong>. ${justificacion}</p>`;
                        }
                    } else { alert('Por favor, selecciona una opci√≥n.'); }
                });
            }

            obligationSelect.addEventListener('change', () => {
                const selected = obligationsData.find(item => item.id == obligationSelect.value);
                selectedObligationText.textContent = selected ? selected.obligacion : '';
                generateGuideBtn.disabled = !selected;
            });

            topicSelect.addEventListener('change', () => {
                generateQuestionBtn.disabled = !topicSelect.value;
            });
            
            generateGuideBtn.addEventListener('click', () => {
                const selectedId = obligationSelect.value;
                if (!selectedId) { alert('Por favor, seleccione una obligaci√≥n.'); return; }
                const obligation = obligationsData.find(item => item.id == selectedId);
                const prompt = `Act√∫a como un auditor experto en PLD/FT en M√©xico. Basado en la obligaci√≥n de auditor√≠a: '${obligation.obligacion}', fundamentada en '${obligation.fuente_lineamiento}' y que revisa el cumplimiento de la '${obligation.fuente_disposicion_bancos}'. Genera una gu√≠a pr√°ctica inspirada en la estructura de un dictamen real de GMC360. Responde √∫nicamente con un objeto JSON v√°lido con las claves "pruebas_sugeridas", "posibles_hallazgos", y "recomendaciones_mejora", cada una con un array de 3 a 4 strings concisos y profesionales.`;
                const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }], generationConfig: { responseMimeType: "application/json" } };
                handleApiCall('asistente', payload);
            });

            generateQuestionBtn.addEventListener('click', () => {
                const selectedTopic = topicSelect.value;
                if (!selectedTopic) { alert('Por favor, seleccione un tema.'); return; }
                const prompt = `Act√∫a como un creador de ex√°menes para la certificaci√≥n de auditores PLD/FT en M√©xico, inspirado en el estilo de un dictamen de GMC360. Genera un caso pr√°ctico realista y una pregunta de opci√≥n m√∫ltiple sobre el tema "${selectedTopic}". Responde √∫nicamente con un objeto JSON v√°lido con las claves "caso_practico", "pregunta", "opciones" (un objeto con A,B,C,D), "respuesta_correcta" (la letra), y "justificacion" (explicando la respuesta y citando la normativa de forma concisa).`;
                const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }], generationConfig: { responseMimeType: "application/json" } };
                handleApiCall('simulador', payload);
            });

            setupTabs();
            populateSelects();
        });
    </script>
</body>
</html>

